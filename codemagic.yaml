workflows:
  dev-workflow:
    name: Dev
    max_build_duration: 120
    instance_type: mac_mini_m2
    environment:
      flutter: stable # Or a specific version
      xcode: latest # Or a specific version

    scripts:
      # Set up environment
      - name: Set up Flutter
        script: flutter pub get

      # Run Tests (Add this section)
      - name: Run Flutter Tests
        script: flutter test --coverage

      # Android build
      - name: Build Android APK
        script: |
          flutter build apk --release --split-per-abi
          find build/app/outputs/flutter-apk/ -name "*.apk" -exec mv {} build/app/outputs/apk \;

      # iOS build
      - name: Build iOS IPA
        script: |
          xcodebuild -workspace ios/Runner.xcworkspace \
                     -scheme Runner \
                     -sdk iphoneos \
                     -configuration Release \
                     build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO

    artifacts:
      - build/app/outputs/apk/*.apk
      - build/ios/build/Release-iphoneos/*.ipa
      - coverage/ #include coverage reports

    publishing:
      email:
        # Replace with your email address
        recipients:
          - fandiaspraja@gmail.com
        # notify:
        #   success: true
        #   failure: false
